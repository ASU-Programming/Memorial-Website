{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags %}
{% load breadcrumbs_tags %}

{% block extra_css %}
<style>
    .carousel-inner {
        display: flex;
        transition: transform 0.5s ease;
    }
    .carousel-item {
        flex: 0 0 50%;
    }
</style>
{% endblock %}

{% block content %}
<div class="person-page container mx-auto mt-10 p-4 bg-white shadow rounded-lg">
    {% breadcrumbs %}
    <h1 class="text-3xl font-bold mb-4">{{ page.title }}</h1>

    <div class="person-info flex mb-6">
        {% if page.image %}
        <div class="w-1/3">
            {% image page.image max-300x300 class="rounded-lg shadow" %}
        </div>
        {% endif %}

        <div class="details ml-6">
            {% if page.rank_or_title %}
            <p class="rank text-lg font-semibold">{{ page.rank_or_title }}</p>
            {% endif %}

            {% if page.unit_or_affiliation %}
            <p class="unit text-lg">{{ page.unit_or_affiliation }}</p>
            {% endif %}

            {% if page.birth_date %}
            <p class="birth-date text-sm text-gray-600">Born: {{ page.birth_date|date:"d.m.Y" }}</p>
            {% endif %}

            {% if page.death_date %}
            <p class="death-date text-sm text-gray-600">Died: {{ page.death_date|date:"d.m.Y" }}</p>
            {% endif %}
        </div>
    </div>

    {% if page.description %}
    <div class="biography prose max-w-none mb-6">
        {{ page.description|richtext }}
    </div>
    {% endif %}

    {% if page.gallery_images.all %}
    <div id="personCarousel" class="carousel relative w-full overflow-hidden">
        <div class="carousel-inner flex">
            {% for item in page.gallery_images.all %}
            <div class="carousel-item bg-gray-100 flex flex-col items-center p-4 rounded-lg shadow mr-4">
                {% image item.image max-400x300 class="rounded-lg" %}
                {% if item.caption %}
                <div class="carousel-caption bg-gray-800 text-white p-2 rounded mt-2">
                    <p>{{ item.caption }}</p>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        <a class="carousel-control carousel-control-prev absolute top-1/2 transform -translate-y-1/2 left-2 bg-gray-800 text-white p-2 rounded" href="#" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true">&#10094;</span>
            <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control carousel-control-next absolute top-1/2 transform -translate-y-1/2 right-2 bg-gray-800 text-white p-2 rounded" href="#" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true">&#10095;</span>
            <span class="sr-only">Next</span>
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const carousel = document.querySelector('#personCarousel');
        const carouselInner = carousel.querySelector('.carousel-inner');
        const items = carousel.querySelectorAll('.carousel-item');
        const prevBtn = carousel.querySelector('.carousel-control-prev');
        const nextBtn = carousel.querySelector('.carousel-control-next');
        let currentIndex = 0;

        function showItems(index) {
            carouselInner.style.transform = `translateX(-${index * 50}%)`;
        }

        prevBtn.addEventListener('click', function(e) {
            e.preventDefault();
            currentIndex = Math.max(currentIndex - 2, 0);
            showItems(currentIndex);
        });

        nextBtn.addEventListener('click', function(e) {
            e.preventDefault();
            currentIndex = Math.min(currentIndex + 2, items.length - 2);
            showItems(currentIndex);
        });

        // Show the first two items initially
        showItems(0);
    });
</script>
{% endblock %}
